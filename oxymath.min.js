!function(){window.Oxymath=Oxymath;var config={safe_mode:true,tol:1e-12};function Oxymath(){}var ERROR_TYPE=Oxymath.ERROR_TYPE={DIMENSION_ERROR:0,OBJECT_TYPE_MISMATCH:1,RANGE_ERROR:2,UNDEFINED:100};var Error=Oxymath.Error=function(message,type,info){this.error_message=message;this.error_type=type;this.debug_info=info};function _Oxymath(){}var create=_Oxymath.prototype.create=function(constructor_function,args){function f(){return constructor_function.apply(this,args)}f.prototype=constructor_function.prototype;return new f};_Oxymath.prototype.overload=function(name,fn){var oldImplementation=this[name];this[name]=function(){if(fn.length===arguments.length){return fn.apply(this,arguments)}else if(typeof oldImplementation==="function")return oldImplementation.apply(this,arguments)}};var do_init=false;_Oxymath.subClass=function _subClass(child){var parent=this.prototype;do_init=false;var prototype=new this;do_init=true;for(var member in child){prototype[member]=typeof child[member]==="function"&&typeof parent[member]==="function"?function(member){return function(){var old=this.parent;this.parent=parent[member];var result=child[member].apply(this,arguments);this.parent=old;return result}}(member):child[member]}function Obj(){this._private={};if(do_init&&this.init){this.init.apply(this,arguments)}}Obj.prototype=prototype;Obj.subClass=_subClass;return Obj};var Matrix=Oxymath.Matrix=_Oxymath.subClass({init:function(){if(!this._private._initialized){this.size={m:0,n:0};var storage=this._private._storage=storage=storage?storage:[];this.overload("init",function(arr){if(arr instanceof Matrix){this.init(arr.size.m,arr.size.n);this.forEach(function(m,n){this.set(m,n,arr.get(m,n))});return}if(!(arr instanceof Array)||!arr.length||!(arr[0]instanceof Array)||!arr[0].length)throw new Error("Matrix initialization error: Array of Arrays expected",ERROR_TYPE.OBJECT_TYPE_MISMATCH,arr);for(var i=0;i<arr.length;i++){if(!(arr[i]instanceof Array)||arr[i].length!==arr[0].length)throw new Error("Matrix initialization error: Rows have different sizes",ERROR_TYPE.DIMENSION_ERROR);storage.push(arr[i])}this.size.m=arr.length;this.size.n=arr[0].length});this.overload("init",function(m,n,init_value){if(m>0&&n>0){this.size.m=m;this.size.n=n;for(var i=0;i<m;i++){var row=new Array(n);for(var k=0;k<n;k++)row[k]=init_value?init_value:0;storage.push(row)}}else throw new Error("Matrix initialization error: Wrong matrix size",ERROR_TYPE.DIMENSION_ERROR,{m:m,n:n})});this.overload("init",function(m,n){this.init(m,n,0)});this._private._initialized=true;this.init.apply(this,arguments)}},det:function(){var lu_dec=this.lu();var det=1;for(var i=1;i<=this.size.m;i++)det=det*lu_dec.L.get(i,i);return det*lu_dec.signum},exchangeRows:function(i,j){if(i>this.size.m||j>this.size.m||i<1||j<1)throw new Error("Wrong indices during the row exchange",ERROR_TYPE.RANGE_ERROR);var tmp=this._private._storage[i-1];this._private._storage[i-1]=this._private._storage[j-1];this._private._storage[j-1]=tmp;return this},forEach:function(fn){for(var m=0;m<this.size.m;m++)this.forEachInRow(m+1,fn);return this},forEachInRow:function(row_number,fn){for(var n=0;n<this.size.n;n++)try{fn.call(this,row_number,n+1)}catch(stop_execution){if(stop_execution)break}return this},get:function(index_m,index_n){return this._private._storage[index_m-1][index_n-1]},inv:function(){return inverse(this)},isEqual:function(matrix){if(!(matrix instanceof Matrix)||!this.isSameSize(matrix))return false;var equal=true;this.forEach(function(m,n){if(Math.abs(this.get(m,n)-matrix.get(m,n))>config.tol){equal=false;throw true}});return equal},isSameSize:function(matrix){if(matrix instanceof Matrix)return this.size.m===matrix.size.m&&this.size.n===matrix.size.n;else return false},lu:function(){return luCrout(this)},minus:function(B){var A=this;var C=new Matrix(A);return C.unsafeMinus(B)},plus:function(B){var A=this;var C=new Matrix(A);return C.unsafePlus(B)},set:function(index_m,index_n,value){this._private._storage[index_m-1][index_n-1]=value;return this},times:function(multiplier){var A=this;if(typeof multiplier==="number")return new Matrix(this.size.m,this.size.n).forEach(function(m,n){this.set(m,n,multiplier*A.get(m,n))});if(multiplier instanceof Matrix){return naiveMatrixMultiplication(A,multiplier)}throw new Error("Matrix multiplication error",ERROR_TYPE.OBJECT_TYPE_MISMATCH)},transpose:function(){var A=this;return new Matrix(this.size.n,this.size.m).forEach(function(m,n){this.set(m,n,A.get(n,m))})},unsafeMinus:function(B){var A=this;if(!this.isSameSize(B)){throw new Error("Matrix subtraction error: Matrices have different size",ERROR_TYPE.DIMENSION_ERROR)}return A.forEach(function(m,n){this.set(m,n,A.get(m,n)-B.get(m,n))});return A},unsafePlus:function(B){var A=this;if(!this.isSameSize(B)){throw new Error("Matrix addition error: Matrices have different size",ERROR_TYPE.DIMENSION_ERROR)}return A.forEach(function(m,n){this.set(m,n,A.get(m,n)+B.get(m,n))});return A}});var Identity=Oxymath.Identity=Matrix.subClass({init:function(m){if(!this._private._initialized){if(typeof m==="number"&&m){this.parent(m,m);this.forEach(function(m,n){this.set(m,n,m===n?1:0)})}else throw Error("Error initializing identity matrix",ERROR_TYPE.OBJECT_TYPE_MISMATCH,m)}}});var Vector=Oxymath.Vector=Matrix.subClass({init:function(vector){if(!this._private._initialized){if(typeof vector==="number"&&vector){this.parent(vector,1);return}if(vector instanceof Array&&vector.length){this.parent(vector.length,1);this.forEach(function(m){this.set(m,vector[m-1])});return}if(vector instanceof Vector){this.parent(vector);return}throw new Error("Vector initialization error: Array or Integer or Vector expected",ERROR_TYPE.OBJECT_TYPE_MISMATCH,vector)}},dot:function(B){var A=this;if(!A.isSameSize(B))throw new Error("Vector dot product error: Vectors have different size",ERROR_TYPE.DIMENSION_ERROR);var product=0;for(var m=1;m<=A.length();m++)product+=A.get(m)*B.get(m);return product},get:function(index_m){return this.parent(index_m,1)},minus:function(B){var A=this;var C=new Vector(A);return C.unsafeMinus(B)},norm:function(){var len=0;this.forEach(function(m){len+=this.get(m)*this.get(m)});return Math.sqrt(len)},plus:function(B){var A=this;var C=new Vector(A);return C.unsafePlus(B)},set:function(index_m,value){return this.parent(index_m,1,value)},length:function(){return this.size.m}});function naiveMatrixMultiplication(A,B){if(!(A instanceof Matrix)||!(B instanceof Matrix))throw new Error("Only matrices or Vectors can be multiplied",ERROR_TYPE.OBJECT_TYPE_MISMATCH);if(A.size.n!==B.size.m)throw new Error("Multiplication error: Matrices size mismatch",ERROR_TYPE.DIMENSION_ERROR);var C=B instanceof Vector?new Vector(A.size.m):new Matrix(A.size.m,B.size.n);return C.forEach(function(m,n){var sum=0;for(var i=1;i<=A.size.n;i++)sum+=A.get(m,i)*B.get(i,n);C instanceof Vector?this.set(m,sum):this.set(m,n,sum)})}function luCrout(A){if(!(A instanceof Matrix))throw new Error("Only matrices can be decomposed",ERROR_TYPE.OBJECT_TYPE_MISMATCH);if(A.size.n!==A.size.m)throw new Error("Decomposition error: Matrix must be square",ERROR_TYPE.DIMENSION_ERROR);var size=A.size.n;P=new Identity(size);L=new Identity(size);U=new Matrix(A);signum=1;for(var i=1;i<=size;i++){if(U.get(i,i)==0){var max_index=i;for(var j=i;j<=size;j++)if(U.get(j,i)>U.get(max_index,i))max_index=j;if(U.get(max_index,i)!=0){U.exchangeRows(i,max_index);P.exchangeRows(i,max_index);signum=signum*-1}else throw new Error("Decomposition error: Matrix is singular",ERROR_TYPE.UNDEFINED)}if(U.get(i,i)!=1){L.set(i,i,U.get(i,i));U.forEachInRow(i,function(m,n){this.set(m,n,this.get(m,n)/L.get(i,i))})}if(i!=size)for(var j=i+1;j<=size;j++){var pivot=U.get(j,i);L.set(j,i,pivot);U.forEachInRow(j,function(m,n){this.set(m,n,this.get(m,n)-pivot*this.get(i,n))})}}return{A:A,P:P,U:U,L:L,signum:signum}}function backSubstitution(U,B){if(!(U instanceof Matrix)||!(B instanceof Matrix))throw new Error("BackSubstitution Error: Expecting 2 matrices",ERROR_TYPE.OBJECT_TYPE_MISMATCH);if(U.size.n!=B.size.m)throw new Error("BackSubstitution Error: B and U size mismatch",ERROR_TYPE.DIMENSION_ERROR);var X=new Matrix(B.size.m,B.size.n,0);for(var j=1;j<=B.size.n;j++){for(var i=B.size.m;i>=1;i--){X.set(i,j,B.get(i,j));for(var k=i+1;k<=B.size.m;k++)X.set(i,j,X.get(i,j)-U.get(i,k)*X.get(k,j));X.set(i,j,X.get(i,j)/U.get(i,i))}}return X}function forwardSubstitution(L,B){if(!(L instanceof Matrix)||!(B instanceof Matrix))throw new Error("ForwardSubstitution Error: Expecting 2 matrices",ERROR_TYPE.OBJECT_TYPE_MISMATCH);if(L.size.n!=B.size.m)throw new Error("ForwardSubstitution Error: B and U size mismatch",ERROR_TYPE.DIMENSION_ERROR);var X=new Matrix(B.size.m,B.size.n,0);for(var j=1;j<=B.size.n;j++){for(var i=1;i<=B.size.m;i++){X.set(i,j,B.get(i,j));for(var k=1;k<=i-1;k++)X.set(i,j,X.get(i,j)-L.get(i,k)*X.get(k,j));X.set(i,j,X.get(i,j)/L.get(i,i))}}return X}function inverse(A){if(!(A instanceof Matrix))throw new Error("Only matrices can be inverted",ERROR_TYPE.OBJECT_TYPE_MISMATCH);if(A.size.n!==A.size.m)throw new Error("Inverse error: Matrix must be square",ERROR_TYPE.DIMENSION_ERROR);a_decomposed=A.lu();var Y=forwardSubstitution(a_decomposed.L,a_decomposed.P.times(new Identity(A.size.m)));return backSubstitution(a_decomposed.U,Y)}Oxymath.createMatrix=function(){return create(Matrix,arguments)};Oxymath.createVector=function(){return create(Vector,arguments)};Oxymath.createIdentity=function(){return create(Identity,arguments)}}();$M=Oxymath.createMatrix;$V=Oxymath.createVector;$I=Oxymath.createIdentity;